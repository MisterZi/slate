---
title: Руководство по работе с API check.inshopper.ru

search: false
---

# Синтаксис запроса

Чтобы обратиться к методу API check.inshopper.ru, Вам необходимо выполнить POST или GET запрос такого вида:

`http://check.inshopper.ru/QUERY?token=TOKEN`

Он состоит из нескольких частей:

* QUERY (обязательно) — запрос, построенный в соответствии требованиями метода, к которому необходимо обратиться. Полный список методов доступен на этой странице.
* TOKEN (опционально) — ключ доступа. Подробнее о получении токена Вы можете узнать в этом руководстве.
* POST (опционально) - тело запроса. Используется в некоторых методах, например для загрузки файлов через API.

# Ключ доступа

>  Пример для curl:

```shell
curl "http://check.inshopper.ru/clients/get_token.json"
  --data "email=LOGIN&password=PASSWORD"
```

> Пример ответа:

```shell
{"token":"aHErLS5IfRWGagzaa90xJqdp1b4T2DG9z"}
```

Такой ключ требуется для работы почти со всеми методами нашего API, за исключением метода получения самого токена.

Для того, чтобы получить код доступа необходимо выполнить запрос, в котором:

`QUERY - get_token.json`

`POST - email=LOGIN&password=PASSWORD`



# Методы для обработки чеков

## Загрузка чека

`QUERY - campaigns/ID_акции/receipts.json`

где `ID_акции` - идентификационный номер, присваиваемый акции при создании. Его можно получить в списке акций в личном кабинете.

### С фотографией

>  Пример для curl:

```shell
curl "http://check.inshopper.ru/campaigns/ID_акции/receipts.json?token=ТОКЕН"
  -F "receipt[image]=@ПУТЬ_К_ФОТОГРАФИИ.jpg;type=image/jpg"
```

`POST - receipt[image]=ФОТО_ЧЕКА&receipt[external_id]=ИДЕНТИФИКАТОР_ПОЛЬЗОВАТЕЛЯ_В_БАНКЕ(опционально)`

Формат файла изображения должен быть jpg, размер файла не должен превышать 10 МБ. Разрешение должно быть не меньше 600х600 пикселей.

### С содержимым QR кода в чеках

>  Пример для curl:

```shell
curl "http://check.inshopper.ru/campaigns/ID_акции/receipts.json?token=ТОКЕН"
  --data "receipt[no_image]=true&receipt[qr_string]=QR_STRING&receipt[external_id]=EXTERNAL_ID"
```

`POST - receipt[no_image]=true&receipt[qr_string]=СОДЕРЖИМОЕ_QR_КОДА&receipt[external_id]=ИДЕНТИФИКАТОР_ПОЛЬЗОВАТЕЛЯ_В_БАНКЕ(опционально)`

Формат содержимого QR кода должен быть:

**t=**ггггммдд**T**ччмм**&s=**сумма**&fn=**фискальный-накопитель**&i=**фискальный-документ**&fp=**фискальный-признак-документа

### Ответ сервера

> Пример ответа:

```shell
# при успешной загрузке
{"id":5,"state":"ok"}
```

```shell
# при ошибке
{"state":"error"}
```

В обоих случаях, при успешной загрузке чека, ответ будет одинаковым:

`{"id":id-чека,"state":статус}`

Где id-чека - уникальный идентификатор, присвоенный чеку



## Проверка состояния чека

> Пример ответа:

```shell
{"id":5,"state":"unfilled", "extra": ""}
state - статус чека
```

`QUERY - campaigns/ID_акции/receipts/ID_чека.json`

В качестве параметра `ID_чека` отдаем id, полученный при загрузке чека.


### Типы состояний (state)

Тип | Значение
--------- | -----------
good |  чек прошел проверку кпк, чек валиден
processing |  чек отправлен на проверку кпк
unfilled |  данные чека распознаются
rejected |  чек отклонен

При значении rejected появляется дополнительное поле reject_reason, которое может принимать значения:

### Типы отклонений (reject_reason):

> Пример ответа:

```shell
{"id":11,"state":"rejected","extra":"","reject_reason":"undecipherable"}
extra - дополнительные данные
```

Тип | Значение
--------- | -----------
undecipherable |  Неразборчив (нет возможности распознать данные)
kpkless |  Не содержит КПК (бывает, что чеки не содрежат кпк, например, при оплате картой)
clipped |  Чек сфотографирован не полностью
nocheck |  Изображение некорректно, на фото не чек
nocampaign |  В чеке нет акционных товаров
wrongshop |  Магазин не участвует в акции
wrongcircs |  Не выполнены условия акции
notvalid |  Чек недействителен (для чеков с фотошопом, подделка на взгляд модератора)
fewchecks |  Несколько чеков на фото
oldchecks |  Слишком старый чек(дата покупки за пределами промо периода)
invalidkpk |  Не валидный кпк(чек прошел проверку кпк)
dublicate |  Чек является дубликатом
outlimit |  Превышен лимит акции

> Пример ответа:

```shell
{"id":5,"state":"good", "extra": {"quantity": "2"}}
```

Возможное содержимое extra:

Quantity – количество по акционным товарам



# Список активных акций пользователя

> Пример для curl:

```shell
curl "http://check.inshopper.ru/campaigns.json?token=TOKEN&user_id=USER_ID"
```

`QUERY - campaigns.json?user_id=ID_ПОЛЬЗОВАТЕЛЯ`

> Пример ответа:

```shell
{"campaigns":{"1":{"name":"Акция_1","limit":0,"logo_url":"no image","description":"Описание"},"2":{"name":"Акция_2","limit":10,"logo_url":"URL на картинку","description":"Описание"}}}
Где name - название акции
limit - лимит по количеству участий в этой акции
logo_url - URL на картинку
description - описание правил участия
```

